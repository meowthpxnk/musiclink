server {
    listen 443 ssl;
    server_name musiclink.meowthland.ru;

    # Общие заголовки для прокси
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Защита админ-панели и API по IP whitelist
    # Разрешаем доступ только с указанных IP адресов
    # Добавьте свои IP адреса здесь
    location ~ ^/(dashboard|api/tracks) {
        set $allowed 0;
        if ($remote_addr = 127.0.0.1) { set $allowed 1; }
        if ($remote_addr = ::1) { set $allowed 1; }
        # if ($remote_addr = YOUR_IP_ADDRESS) { set $allowed 1; }
        # if ($remote_addr = YOUR_IP_ADDRESS_2) { set $allowed 1; }

        if ($allowed = 0) {
            return 301 /;
        }

        proxy_pass http://local_server:9911;
    }

    location / {
        proxy_pass http://local_server:9911;
    }
}

server {
    ## Redirect from link.meowthland.ru/wgFC to musiclink.meowthland.ru/posledniy_tanec
    listen 443 ssl;
    server_name link.meowthland.ru;

    location = /wgFC {
        return 301 https://musiclink.meowthland.ru/posledniy_tanec;
    }
}
